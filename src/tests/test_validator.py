# -*- coding: utf-8 -*-
"""
Created on Tue Aug  8 11:01:45 2017

@author: PogrebnyakEV
"""

import pandas as pd
from io import StringIO

import validator as vldr


def to_dataframe(text):
    return pd.read_csv(StringIO(text), sep="\t")


dfa_text = """	year	CPI_ALCOHOL_rog	CPI_FOOD_rog	CPI_NONFOOD_rog	CPI_SERVICES_rog	CPI_rog	EXPORT_GOODS_bln_usd	GDP_bln_rub	GDP_yoy	GOV_EXPENSE_ACCUM_CONSOLIDATED_bln_rub	GOV_EXPENSE_ACCUM_FEDERAL_bln_rub	GOV_EXPENSE_ACCUM_SUBFEDERAL_bln_rub	GOV_REVENUE_ACCUM_CONSOLIDATED_bln_rub	GOV_REVENUE_ACCUM_FEDERAL_bln_rub	GOV_REVENUE_ACCUM_SUBFEDERAL_bln_rub	GOV_SURPLUS_ACCUM_FEDERAL_bln_rub	GOV_SURPLUS_ACCUM_SUBFEDERAL_bln_rub	IMPORT_GOODS_bln_usd	INDPRO_yoy	INVESTMENT_bln_rub	INVESTMENT_yoy	RETAIL_SALES_FOOD_bln_rub	RETAIL_SALES_FOOD_yoy	RETAIL_SALES_NONFOOD_bln_rub	RETAIL_SALES_NONFOOD_yoy	RETAIL_SALES_bln_rub	RETAIL_SALES_yoy	TRANSPORT_FREIGHT_bln_tkm	UNEMPL_pct	WAGE_NOMINAL_rub	WAGE_REAL_yoy
1999-12-31	1999	143.2	135.0	139.2	134.0	136.5	75.6	4823.0	106.4	1258.0	666.9	653.8	1213.6	615.5	660.8	-51.4	7.0	39.5		670.4	105.3	866.1	93.6	931.3	94.7	1797.4	94.2	3372.0	13.0	1523.0	78.0
2000-12-31	2000	125.0	117.1	118.5	133.7	120.2	105.0	7306.0	110.0	1960.1	1029.2	1032.1	2097.7	1132.1	1065.8	102.9	33.8	44.9		1165.2	117.4	1093.2	107.5	1259.1	110.5	2352.3	109.0	3542.0	10.5	2223.0	120.9
2001-12-31	2001	112.6	117.8	112.7	136.9	118.6	101.9	8944.0	105.1	2419.4	1321.9	1330.2	2683.7	1594.0	1322.4	272.1	-7.8	53.8		1504.7	111.7	1416.8	107.6	1653.2	113.9	3070.0	111.0	3651.0	9.0	3240.0	119.9
2002-12-31	2002	108.9	111.3	110.9	136.2	115.1	107.3	10831.0	104.7	3422.3	2054.2	1687.2	3519.2	2204.7	1633.6	150.5	-53.6	61.0		1762.4	102.9	1753.9	110.1	2011.5	108.6	3765.4	109.3	3868.0	8.0	4360.0	116.2
2003-12-31	2003	109.9	110.2	109.2	122.3	112.0	135.9	13208.0	107.3	3964.9	2358.6	1984.3	4138.7	2586.2	1930.5	227.6	-53.8	76.1		2186.4	112.7	2091.7	107.7	2438.0	109.7	4529.7	108.8	4171.0	8.2	5499.0	110.9
2004-12-31	2004	108.7	113.0	107.4	117.7	111.7	183.2	17027.0	107.2	4669.7	2698.9	2373.0	5429.9	3428.9	2403.2	730.0	30.2	97.4		2865.0	116.8	2580.3	111.4	3062.2	115.1	5642.5	113.3	4441.0	7.7	6740.0	110.6
2005-12-31	2005	107.6	109.9	106.4	121.0	110.9	240.0	21610.0	106.4	6820.6	3514.3	2941.2	8579.6	5127.2	2999.9	1612.9	58.7	123.8		3611.1	110.2	3217.6	110.5	3823.9	115.1	7041.5	112.8	4550.0	7.1	8555.0	112.6
2006-12-31	2006	110.1	108.4	106.0	113.9	109.0	297.5	26917.0	108.2	8375.2	4284.8	3657.7	10625.8	6278.9	3797.3	1994.1	139.6	163.2		4730.0	117.8	3947.4	111.0	4764.5	116.8	8711.9	114.1	4675.0	7.0	10634.0	113.3
2007-12-31	2007	107.7	117.1	106.5	113.3	111.9	346.5	33248.0	108.5	11378.6	5986.6	4790.5	13368.3	7781.1	4828.5	1794.6	38.0	223.1		6716.2	123.8	4891.4	112.6	5977.6	119.1	10869.0	116.1	4788.0	6.0	13593.0	117.2
2008-12-31	2008	110.9	117.6	108.0	115.9	113.3	466.3	41277.0	105.2	14157.0	7570.9	6253.1	16169.1	9275.9	6198.8	1705.1	-54.4	288.7		8781.6	109.5	6495.7	111.7	7448.5	115.3	13944.2	113.7	4820.0	6.2	17290.0	111.5
2009-12-31	2009	108.9	105.5	109.7	111.6	108.8	297.2	38807.0	92.2	16048.3	9660.1	6255.7	13599.7	7337.8	5926.6	-2322.3	-329.1	183.9		7976.0	86.5	7097.1	98.1	7502.1	91.8	14599.2	94.9	4344.0	8.2	18638.0	96.5
2010-12-31	2010	108.3	113.7	105.0	108.1	108.8	392.7	46308.0	104.5	17616.7	10117.5	6636.9	16031.9	8305.4	6537.3	-1812.0	-99.6	245.7		9152.1	106.3	8002.2	105.1	8509.8	108.0	16512.0	106.5	4645.0	7.3	20952.0	105.2
2011-12-31	2011	108.4	103.2	106.7	108.7	106.1	515.4	59698.0	104.3	19994.6	10925.6	7679.1	20855.4	11367.7	7644.2	442.0	-34.9	318.6		11035.7	110.8	9104.3	103.4	10000.0	110.8	19104.3	107.1	4799.0	6.5	23369.0	102.8
2012-12-31	2012	112.1	106.7	105.2	107.3	106.6	527.4	66927.0	103.5	23174.7	12895.0	8343.2	23435.1	12855.5	8064.5	-39.4	-278.7	335.8		12586.1	106.8	9961.4	103.6	11433.1	108.6	21394.5	106.3	4934.0	5.5	26629.0	108.4
2013-12-31	2013	114.6	106.1	104.5	108.0	106.5	521.8	71017.0	101.3	25290.9	13342.9	8806.6	24442.7	13019.9	8165.1	-323.0	-641.5	341.3		13450.3	100.8	11143.0	102.6	12542.9	104.9	23685.9	103.9	4958.0	5.5	29792.0	104.8
2014-12-31	2014	113.7	115.7	108.1	110.5	111.4	496.8	79200.0	100.7	27611.7	14831.6	9353.3	26766.1	14496.9	8905.7	-334.7	-447.6	307.9		13902.6	98.5	12380.9	100.0	13975.3	105.1	26356.2	102.7	4955.0	5.2	32495.0	101.2
2015-12-31	2015	110.7	114.5	113.7	110.2	112.9	341.5	83233.0	97.2	29741.5	15620.3	9479.8	26922.0	13659.2	9308.2	-1961.0	-171.6	193.0	99.2	13897.2	89.9	13412.3	91.0	14114.5	89.1	27526.8	90.0	4978.0	5.6	34030.0	91.0
2016-12-31	2016	106.4	104.3	106.5	104.9	105.4	281.7	86044.0	99.8	31323.7	16416.4	9936.4	28181.5	13460.0	9923.8	-2956.4	-12.6	191.7	101.3	14639.8	99.1	13751.8	95.0	14565.5	95.8	28317.3	95.4	5070.0	5.5	36709.0	100.8"""

dfq_text = """	year	qtr	CPI_ALCOHOL_rog	CPI_FOOD_rog	CPI_NONFOOD_rog	CPI_SERVICES_rog	CPI_rog	EXPORT_GOODS_bln_usd	GDP_bln_rub	GDP_yoy	GOV_EXPENSE_ACCUM_CONSOLIDATED_bln_rub	GOV_EXPENSE_ACCUM_FEDERAL_bln_rub	GOV_EXPENSE_ACCUM_SUBFEDERAL_bln_rub	GOV_REVENUE_ACCUM_CONSOLIDATED_bln_rub	GOV_REVENUE_ACCUM_FEDERAL_bln_rub	GOV_REVENUE_ACCUM_SUBFEDERAL_bln_rub	GOV_SURPLUS_ACCUM_FEDERAL_bln_rub	GOV_SURPLUS_ACCUM_SUBFEDERAL_bln_rub	IMPORT_GOODS_bln_usd	INDPRO_rog	INDPRO_yoy	INVESTMENT_bln_rub	INVESTMENT_rog	INVESTMENT_yoy	RETAIL_SALES_FOOD_bln_rub	RETAIL_SALES_FOOD_rog	RETAIL_SALES_FOOD_yoy	RETAIL_SALES_NONFOOD_bln_rub	RETAIL_SALES_NONFOOD_rog	RETAIL_SALES_NONFOOD_yoy	RETAIL_SALES_bln_rub	RETAIL_SALES_rog	RETAIL_SALES_yoy	TRANSPORT_FREIGHT_bln_tkm	UNEMPL_pct	WAGE_NOMINAL_rub	WAGE_REAL_rog	WAGE_REAL_yoy
1999-03-31	1999	1	118.2	118.4	114.0	109.5	116.0	15.3	901.0	98.1	189.0	108.3	91.5	171.9	89.1	93.6	-19.2	2.1	9.1			96.8		93.8	186.8	85.0	92.7	192.2	90.7	84.3	379.0	88.0	88.1	821.0	14.3	1248.0	80.9	60.7
1999-06-30	1999	2	106.8	106.4	108.6	109.0	107.3	17.1	1102.0	103.1	486.8	272.1	240.0	448.6	226.6	247.3	-45.5	7.3	10.1			131.1		99.2	204.3	101.4	91.6	212.2	100.2	88.5	416.5	100.8	90.0	831.0	13.0	1511.0	111.5	65.1
1999-09-30	1999	3	106.0	104.3	107.2	107.2	105.6	18.9	1373.0	111.4	795.8	434.2	400.6	759.3	387.3	411.0	-46.9	10.4	9.5			185.6		105.0	222.6	103.1	89.2	242.0	107.0	91.3	464.6	105.1	90.3	833.0	12.3	1642.0	102.4	76.4
1999-12-31	1999	4	107.1	102.8	104.9	104.7	103.9	24.3	1447.0	112.0	1258.0	666.9	653.8	1213.6	615.5	660.8	-51.4	7.0	10.8			256.9		117.4	252.4	110.3	98.0	284.9	110.8	107.8	537.3	110.6	103.1	887.0	12.5	1927.0	112.9	104.7"""

dfm_text = """ 	year	month	CPI_ALCOHOL_rog	CPI_FOOD_rog	CPI_NONFOOD_rog	CPI_SERVICES_rog	CPI_rog	EXPORT_GOODS_bln_usd	GOV_EXPENSE_ACCUM_CONSOLIDATED_bln_rub	GOV_EXPENSE_ACCUM_FEDERAL_bln_rub	GOV_EXPENSE_ACCUM_SUBFEDERAL_bln_rub	GOV_REVENUE_ACCUM_CONSOLIDATED_bln_rub	GOV_REVENUE_ACCUM_FEDERAL_bln_rub	GOV_REVENUE_ACCUM_SUBFEDERAL_bln_rub	GOV_SURPLUS_ACCUM_FEDERAL_bln_rub	GOV_SURPLUS_ACCUM_SUBFEDERAL_bln_rub	IMPORT_GOODS_bln_usd	INDPRO_rog	INDPRO_yoy	INVESTMENT_bln_rub	INVESTMENT_rog	INVESTMENT_yoy	RETAIL_SALES_FOOD_bln_rub	RETAIL_SALES_FOOD_rog	RETAIL_SALES_FOOD_yoy	RETAIL_SALES_NONFOOD_bln_rub	RETAIL_SALES_NONFOOD_rog	RETAIL_SALES_NONFOOD_yoy	RETAIL_SALES_bln_rub	RETAIL_SALES_rog	RETAIL_SALES_yoy	TRANSPORT_FREIGHT_bln_tkm	UNEMPL_pct	WAGE_NOMINAL_rub	WAGE_REAL_rog	WAGE_REAL_yoy
1999-01-31	1999	1	109.7	110.4	106.2	104.1	108.4	4.5	45.6	27.4	22.7	49.0	27.8	25.7	0.4	3.0	2.7			28.5	42.5	92.2	60.3	82.5	90.3	61.5	81.0	79.0	121.8	81.7	84.0	277.7	14.3	1167.0	72.5	58.6
1999-02-28	1999	2	104.2	104.4	104.0	103.2	104.1	4.9	103.1	61.0	49.2	99.3	54.7	51.7	-6.3	2.5	3.0			31.8	108.4	93.8	60.7	96.5	93.7	62.2	97.4	85.4	122.9	96.9	89.2	252.1	14.6	1199.0	99.1	59.0
1999-03-31	1999	3	103.4	102.7	103.2	101.9	102.8	5.8	189.0	108.3	91.5	171.9	89.1	93.6	-19.2	2.1	3.5			36.5	111.2	95.1	65.8	105.5	94.1	68.5	106.6	89.1	134.3	106.0	91.4	291.4	14.0	1385.0	111.7	62.8
1999-04-30	1999	4	103.4	102.5	104.0	103.1	103.0	6.6	285.5	160.1	138.7	264.0	133.9	143.4	-26.2	4.7	3.3			36.9	97.2	94.7	66.2	98.1	90.6	69.2	97.1	87.5	135.4	97.6	88.9	277.1	13.5	1423.0	100.0	64.0
1999-05-31	1999	5	101.8	102.0	102.7	102.1	102.2	5.1	380.8	213.4	185.0	349.9	173.7	193.8	-39.7	8.8	2.9			41.4	109.2	99.2	68.6	101.6	91.8	70.3	98.9	87.8	138.9	100.2	89.7	282.1	12.9	1472.0	101.2	65.1
1999-06-30	1999	6	101.4	101.8	101.6	103.5	101.9	5.4	486.8	272.1	240.0	448.6	226.6	247.3	-45.5	7.3	4.0			52.8	124.3	102.9	69.5	99.6	92.4	72.7	101.8	90.3	142.2	100.7	91.3	271.9	12.8	1626.0	107.7	66.0
1999-07-31	1999	7	102.1	103.3	101.9	103.1	102.8	6.3	588.6	328.9	288.5	550.7	282.1	297.4	-46.8	8.9	3.2			56.2	102.6	102.1	71.6	99.8	90.1	74.2	100.1	88.4	145.8	100.0	89.2	276.2	12.5	1618.0	96.9	65.0
1999-08-31	1999	8	101.9	100.3	102.4	101.9	101.2	6.2	694.4	381.7	345.5	658.7	334.3	356.7	-47.4	11.2	3.1			61.8	106.2	101.9	74.0	102.9	88.5	83.6	110.0	89.0	157.6	106.5	88.8	281.2	12.1	1608.0	98.1	69.3
1999-09-30	1999	9	102.0	100.7	102.7	102.0	101.5	6.4	795.8	434.2	400.6	759.3	387.3	411.0	-46.9	10.4	3.1			67.6	104.1	111.1	77.0	103.2	89.1	84.2	98.2	95.0	161.2	100.5	92.2	275.2	12.2	1684.0	103.1	93.9
1999-10-31	1999	10	101.9	100.7	102.2	102.0	101.4	7.0	897.8	488.8	454.0	868.1	445.6	467.5	-43.2	13.5	3.4			66.5	95.1	114.8	79.1	101.8	94.8	88.0	102.4	108.4	167.1	102.1	101.9	292.8	12.4	1716.0	100.4	97.8
1999-11-30	1999	11	102.2	100.9	101.5	101.7	101.2	7.6	1016.3	540.5	528.0	1006.4	514.9	543.7	-25.6	15.7	3.5			72.0	104.3	112.1	79.1	99.1	94.3	91.1	101.8	109.0	170.2	100.5	101.9	288.9	12.6	1789.0	103.0	102.5
1999-12-31	1999	12	102.8	101.2	101.1	100.9	101.3	9.7	1258.0	666.9	653.8	1213.6	615.5	660.8	-51.4	7.0	4.0			118.4	161.3	122.6	94.2	117.4	104.7	105.8	114.9	106.4	200.0	116.0	105.6	305.6	12.5	2283.0	124.4	113.6"""

dfa = to_dataframe(dfa_text)
dfq = to_dataframe(dfq_text)
dfm = to_dataframe(dfm_text)


def yield_checkpoints():
    for c in vldr.ANNUAL + vldr.QTR + vldr.MONTHLY:
        for pt in vldr.serialise(c):
            yield(pt)


assert vldr.CHECKPOINTS == list(yield_checkpoints())

checkpoint = ('a', 'GDP_bln_rub', 1999, 4823.0)
assert next(
    vldr.serialise(checkpoint)) == {
        'freq': 'a',
        'label': 'GDP_bln_rub',
        'period': False,
        'value': 4823.0,
    'year': 1999}

checkpoint2 = ('q', 'CPI_rog', 1999, {1: 116.0, 2: 107.3, 3: 105.6, 4: 103.9})
gen2 = vldr.serialise(checkpoint2)
assert next(gen2) == {
    'freq': 'q',
    'label': 'CPI_rog',
    'year': 1999,
    'period': 1,
    'value': 116.0}
assert next(gen2) == {
    'freq': 'q',
    'label': 'CPI_rog',
    'year': 1999,
    'period': 2,
    'value': 107.3}

checker = vldr.Validator(dfa, dfq, dfm)

pt = {
    'freq': 'a',
    'label': 'GDP_bln_rub',
    'period': False,
    'value': 4823.0,
    'year': 1999}
z = checker.get_value(pt)
assert z == 4823
assert checker.is_included(pt)

for p in vldr.CHECKPOINTS:
    assert checker.is_included(p)
